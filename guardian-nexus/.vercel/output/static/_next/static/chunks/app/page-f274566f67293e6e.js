(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1847:(e,t,a)=>{Promise.resolve().then(a.bind(a,8751))},8751:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B});var n=a(5155),i=a(2115),s=a(853),r=a(743);let l={Kinetic:0x59570ada,Energy:0x92f16ad9,Power:0x38dcdd35,Helmet:0xcd887e07,Gauntlets:0xd3b5f9fc,Chest:0xd94704,Legs:0x13eb5aa,Class:0x5e8533db,Ghost:0xefcd14be,Vehicle:0x10fc42e7,Ship:0x10fc42e7},o={Mobility:0xb295931f,Resilience:0x1769266f,Recovery:0x73d4c363,Discipline:0x6775dce1,Intellect:0x89e7467,Strength:0xfcfef4b2},c={6:"#ceae33",5:"#522f65",4:"#5076a3",3:"#366f42",2:"#c3bcb4",0:"#c3bcb4"};var d=a(8686),x=a(865),u=a(2402),f=a(9149),h=a(5565),m=a(3463),p=a(9795);function v(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,p.QP)((0,m.$)(t))}let g=e=>{let{src:t,width:a,quality:n}=e;return t.startsWith("http")?t:"https://www.bungie.net".concat(t,"?w=").concat(a,"&q=").concat(n||75)},b=e=>{let{src:t,className:a,alt:s="Destiny Item",...r}=e,[l,o]=(0,i.useState)(!1);return!t||l?(0,n.jsx)("div",{className:v("bg-[#1a1a1a] flex items-center justify-center overflow-hidden",a),children:(0,n.jsx)("div",{className:"w-full h-full opacity-50 bg-slate-800"})}):(0,n.jsx)("div",{className:v("relative overflow-hidden",a),children:(0,n.jsx)(h.default,{src:t,alt:s,loader:g,fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-cover",onError:()=>o(!0),...r})})},y={0x8947c41a:e=>{let{className:t="",size:a=12}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 32 32",width:a,height:a,className:t,children:[(0,n.jsx)("circle",{cx:"16",cy:"16",r:"14",fill:"#79bce1"}),(0,n.jsx)("path",{d:"M16 4 L12 16 H16 L13 28 L22 14 H17 L20 4 Z",fill:"#fff",opacity:"0.9"})]})},0x6e1764f5:e=>{let{className:t="",size:a=12}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 32 32",width:a,height:a,className:t,children:[(0,n.jsx)("circle",{cx:"16",cy:"16",r:"14",fill:"#f0631e"}),(0,n.jsx)("circle",{cx:"16",cy:"16",r:"8",fill:"#fff",opacity:"0.9"}),(0,n.jsx)("circle",{cx:"16",cy:"16",r:"5",fill:"#f0631e",opacity:"0.7"})]})},0xcde51e40:e=>{let{className:t="",size:a=12}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 32 32",width:a,height:a,className:t,children:[(0,n.jsx)("circle",{cx:"16",cy:"16",r:"14",fill:"#b184c5"}),(0,n.jsx)("circle",{cx:"16",cy:"16",r:"8",fill:"transparent",stroke:"#fff",strokeWidth:"3",opacity:"0.9"})]})},0x9056021:e=>{let{className:t="",size:a=12}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 32 32",width:a,height:a,className:t,children:[(0,n.jsx)("polygon",{points:"16,2 30,16 16,30 2,16",fill:"#4d88ff"}),(0,n.jsx)("polygon",{points:"16,8 24,16 16,24 8,16",fill:"#fff",opacity:"0.8"})]})},0xeb6cebaa:e=>{let{className:t="",size:a=12}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 32 32",width:a,height:a,className:t,children:[(0,n.jsx)("circle",{cx:"16",cy:"16",r:"14",fill:"#35d081"}),(0,n.jsx)("path",{d:"M8 16 Q12 8, 16 16 Q20 24, 24 16",fill:"none",stroke:"#fff",strokeWidth:"3",opacity:"0.9"})]})},0xc914c705:e=>{let{className:t="",size:a=12}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 32 32",width:a,height:a,className:t,children:[(0,n.jsx)("circle",{cx:"16",cy:"16",r:"14",fill:"#d0d0d0"}),(0,n.jsx)("circle",{cx:"16",cy:"16",r:"6",fill:"#333"})]})}},w=e=>{var t,a,i,s,r,l,o,h;let{item:m,definition:p,onClick:v,onContextMenu:g,className:w="",isNew:j=!1}=e;if(!m||!p)return(0,n.jsx)("div",{className:"w-[48px] h-[48px] bg-[#1a1a1a]"});let{state:N}=m,k=(4&N)!=0,I=null===(t=p.displayProperties)||void 0===t?void 0:t.icon;I||console.warn("[DestinyItemTile] Missing Icon for:",null===(a=p.displayProperties)||void 0===a?void 0:a.name,p);let M=null===(s=m.instanceData)||void 0===s?void 0:null===(i=s.primaryStat)||void 0===i?void 0:i.value,C=function(e){return e&&y[e]||null}((null===(r=m.instanceData)||void 0===r?void 0:r.damageTypeHash)||p.defaultDamageTypeHash),T=k?"#eade8b":c[null===(l=p.inventory)||void 0===l?void 0:l.tierType]||c[0],S=m.userTag,E=m.userNote;return(0,n.jsxs)("div",{className:"\n                relative box-border select-none cursor-pointer transition-all duration-75\n                w-[48px] h-[48px]\n                border-[2px]\n                hover:brightness-110 group\n                ".concat(w,"\n            "),style:{borderColor:T},onClick:v,onContextMenu:g,children:[(0,n.jsx)(b,{src:I,className:"absolute inset-0 z-0 bg-[#222]"}),k&&(0,n.jsx)("div",{className:"absolute inset-0 border border-[#f5dc56]/30 z-10 pointer-events-none mix-blend-overlay"}),j&&(0,n.jsx)("div",{className:"absolute inset-0 border-2 border-[#50c8ce] shadow-[0_0_8px_#50c8ce] opacity-80 animate-pulse z-20 pointer-events-none"}),p.iconWatermark&&(0,n.jsx)("div",{className:"absolute top-[1px] right-[1px] w-[12px] h-[12px] z-20 pointer-events-none bg-contain bg-no-repeat opacity-90 drop-shadow-md",style:{backgroundImage:"url(https://www.bungie.net".concat(p.iconWatermark,")")}}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 p-[2px] flex flex-col gap-0.5 z-30 pointer-events-none",children:[(1&N)!=0&&(0,n.jsx)(d.A,{size:10,className:"text-[#f5f5f5] drop-shadow-md",strokeWidth:3}),"favorite"===S&&(0,n.jsx)(x.A,{size:10,className:"text-[#f5dc56] fill-[#f5dc56] drop-shadow-md"}),"junk"===S&&(0,n.jsx)(u.A,{size:10,className:"text-red-500 drop-shadow-md",strokeWidth:3}),E&&(0,n.jsx)(f.A,{size:10,className:"text-blue-400 drop-shadow-md",strokeWidth:3})]}),(C||M)&&(0,n.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 h-[14px] bg-gradient-to-t from-black/90 to-black/40 flex items-center px-[2px] justify-between z-20 pointer-events-none",children:[C?(0,n.jsx)(C,{size:11,className:"drop-shadow-sm"}):(0,n.jsx)("div",{}),M&&(0,n.jsx)("span",{className:"text-[10px] leading-none font-bold text-[#f5dc56] drop-shadow-md font-mono tracking-tighter ml-auto",children:M})]}),(0,n.jsxs)("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-3 hidden group-hover:block min-w-[200px] w-max max-w-[260px] bg-[#0f0f0f]/95 border border-white/20 p-3 z-50 rounded-lg shadow-2xl pointer-events-none backdrop-blur-md transition-all duration-200 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0",children:[(0,n.jsx)("div",{className:"text-base font-bold text-white mb-0.5",style:{color:(null===(o=p.inventory)||void 0===o?void 0:o.tierType)===6?"#ceae33":(null===(h=p.inventory)||void 0===h?void 0:h.tierType)===5?"#a38cbe":"white"},children:p.displayProperties.name}),(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-white/10 pb-2 mb-2",children:[(0,n.jsx)("div",{className:"text-xs text-stone-300 font-medium tracking-wide uppercase",children:p.itemTypeDisplayName}),M&&(0,n.jsxs)("div",{className:"text-xs text-[#f5dc56] font-bold",children:["âš¡ ",M]})]}),E?(0,n.jsxs)("div",{className:"bg-[#1a1a1a] p-2 rounded border border-white/5 relative",children:[(0,n.jsx)(f.A,{size:12,className:"absolute top-2 left-2 text-blue-400"}),(0,n.jsxs)("div",{className:"text-xs text-blue-200 italic pl-5 break-words",children:['"',E,'"']})]}):p.flavorText&&(0,n.jsx)("div",{className:"text-[10px] text-gray-500 italic leading-snug",children:p.flavorText})]})]})},j=e=>{let{item:t,definition:a,onContextMenu:i}=e,s=t.itemInstanceId||"hash-".concat(t.itemHash),{attributes:l,listeners:o,setNodeRef:c,isDragging:d}=(0,r.PM)({id:s,data:{item:t,definition:a}});return(0,n.jsx)("div",{ref:c,style:d?{opacity:.3}:void 0,...o,...l,className:"touch-none",children:(0,n.jsx)(w,{item:t,definition:a,className:"w-full h-full",onContextMenu:e=>null==i?void 0:i(e,t,a)})})},N=e=>{let{label:t,bucketHash:a,equipment:i,inventory:s,definitions:r,onItemContextMenu:l}=e,o=i.find(e=>{var t,n;return(null===(n=r[e.itemHash])||void 0===n?void 0:null===(t=n.inventory)||void 0===t?void 0:t.bucketTypeHash)===a}),c=s.filter(e=>{var t,n;return(null===(n=r[e.itemHash])||void 0===n?void 0:null===(t=n.inventory)||void 0===t?void 0:t.bucketTypeHash)===a});return(0,n.jsxs)("div",{className:"flex items-start mb-1 min-h-[50px]",children:[(0,n.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,n.jsxs)("div",{className:"w-[48px] h-[48px] bg-[#292929] border border-white/10 relative group shadow-lg",children:[!o&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-20 text-[9px] uppercase tracking-widest",children:t}),o&&(0,n.jsx)(j,{item:o,definition:r[o.itemHash],onContextMenu:l})]})}),(0,n.jsx)("div",{className:"flex-1 flex flex-wrap gap-[2px] content-start",children:[...Array(9)].map((e,t)=>{let a=c[t];return(0,n.jsx)("div",{className:"w-[48px] h-[48px] bg-[#1a1a1a] relative border border-white/5 box-border",children:a&&(0,n.jsx)(j,{item:a,definition:r[a.itemHash],onContextMenu:l})},t)})})]})},k=e=>{let{character:t,equipment:a,inventory:i,definitions:s,artifactPower:r,onItemContextMenu:c}=e;if(!t)return null;let{light:d,raceType:x,classType:u,emblemBackgroundPath:f,stats:h}=t;return 0===u&&console.log("[Titan Debug] Emblem Background Path:","https://www.bungie.net".concat(f)),(0,n.jsxs)("div",{className:"flex-shrink-0 w-[240px] bg-[#11111b] border-r border-[#333] flex flex-col h-full overflow-hidden select-none relative",children:[(0,n.jsxs)("div",{className:"relative h-[48px] w-full bg-cover bg-center flex items-center justify-between px-2 bg-no-repeat z-20 shadow-md",style:{backgroundImage:"url(https://www.bungie.net".concat(f,")")},children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-black/60 to-transparent"}),(0,n.jsxs)("div",{className:"relative z-10 flex flex-col leading-none",children:[(0,n.jsx)("span",{className:"font-bold text-lg text-[#f5f5f5] tracking-wide drop-shadow-md",children:{0:"Titan",1:"Hunter",2:"Warlock"}[u]}),(0,n.jsx)("span",{className:"text-[10px] text-gray-300 font-medium uppercase tracking-wider opacity-80",children:{0:"Human",1:"Awoken",2:"Exo"}[x]})]}),(0,n.jsxs)("div",{className:"relative z-10 flex flex-col items-end leading-none",children:[(0,n.jsx)("div",{className:"text-xl font-bold text-[#f5dc56] drop-shadow-lg font-mono tracking-tighter shadow-black",children:d}),(0,n.jsxs)("div",{className:"text-[9px] text-[#f5dc56]/80 font-mono",children:[d-r," ",(0,n.jsxs)("span",{className:"text-[#50c8ce]",children:["+",r]})]})]})]}),(0,n.jsx)("div",{className:"flex flex-col bg-[#0a0a10] border-b border-white/5 p-1 gap-0.5 z-10 relative shadow-sm",children:Object.entries(o).map(e=>{let[t,a]=e,i=h[a]||0,s=Math.min(10,Math.floor(i/10));return(0,n.jsxs)("div",{className:"flex items-center gap-2 h-[14px]",children:[(0,n.jsx)("span",{className:"w-8 text-[9px] text-gray-400 uppercase font-bold text-right",children:t.substring(0,3)}),(0,n.jsx)("div",{className:"flex-1 h-2 bg-[#1a1a1a] relative",children:(0,n.jsx)("div",{className:"h-full bg-white/20",style:{width:"".concat(Math.min(100,i),"%")},children:(0,n.jsx)("div",{className:"absolute inset-0 flex",children:[...Array(10)].map((e,t)=>(0,n.jsx)("div",{className:"flex-1 border-r border-black/50 ".concat(t<s?"bg-[#f5dc56]":"opacity-0")},t))})})}),(0,n.jsx)("span",{className:"w-6 text-[10px] text-right font-mono text-[#f5dc56]",children:i})]},t)})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent z-0",children:[(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("div",{className:"text-[9px] text-[#666] font-bold uppercase mb-0.5 px-0.5 tracking-wider hidden",children:"Weapons"}),(0,n.jsx)(N,{label:"Kinetic",bucketHash:l.Kinetic,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Energy",bucketHash:l.Energy,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Power",bucketHash:l.Power,equipment:a,inventory:i,definitions:s,onItemContextMenu:c})]}),(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("div",{className:"text-[9px] text-[#666] font-bold uppercase mb-0.5 px-0.5 tracking-wider hidden",children:"Armor"}),(0,n.jsx)(N,{label:"Helmet",bucketHash:l.Helmet,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Arms",bucketHash:l.Gauntlets,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Chest",bucketHash:l.Chest,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Legs",bucketHash:l.Legs,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Class",bucketHash:l.Class,equipment:a,inventory:i,definitions:s,onItemContextMenu:c})]}),(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("div",{className:"text-[9px] text-[#666] font-bold uppercase mb-0.5 px-0.5 tracking-wider hidden",children:"General"}),(0,n.jsx)(N,{label:"Ghost",bucketHash:l.Ghost,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Vehicle",bucketHash:l.Vehicle,equipment:a,inventory:i,definitions:s,onItemContextMenu:c}),(0,n.jsx)(N,{label:"Ship",bucketHash:l.Ship,equipment:a,inventory:i,definitions:s,onItemContextMenu:c})]})]})]})};function I(e){let{id:t,children:a,className:i,data:s}=e,{setNodeRef:l,isOver:o}=(0,r.zM)({id:t,data:s});return(0,n.jsxs)("div",{ref:l,className:v(i,"relative"),children:[a,o&&(0,n.jsx)("div",{className:"absolute inset-0 bg-[#f5dc56]/10 pointer-events-none z-50 border-2 border-[#f5dc56]"})]})}var M=a(7267);let C=e=>{let{items:t,definitions:a,className:s,onItemContextMenu:r}=e,l=(0,i.useRef)(null),o=Math.floor(7.68),c=Math.ceil(t.length/o),d=(0,M.Te)({count:c,getScrollElement:()=>l.current,estimateSize:()=>50,overscan:5});return(0,n.jsx)("div",{ref:l,className:"overflow-y-auto scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent ".concat(s),style:{height:"100%",width:"100%"},children:(0,n.jsx)("div",{style:{height:"".concat(d.getTotalSize(),"px"),width:"100%",position:"relative"},children:d.getVirtualItems().map(e=>{let i=e.index*o,s=t.slice(i,i+o);return(0,n.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"".concat(e.size,"px"),transform:"translateY(".concat(e.start,"px)"),display:"flex",gap:"2px",paddingLeft:"8px"},children:s.map(e=>(0,n.jsx)("div",{className:"w-[48px] h-[48px] border border-white/5 bg-[#1a1a1a]",children:(0,n.jsx)(j,{item:e,definition:a[e.itemHash],onContextMenu:r})},e.itemInstanceId||e.itemHash))},e.index)})})})};var T=a(7650);let S=e=>{let{x:t,y:a,onClose:s,children:r,className:l}=e,o=(0,i.useRef)(null);return(0,i.useEffect)(()=>{let e=e=>{o.current&&!o.current.contains(e.target)&&s()},t=()=>s(),a=e=>{"Escape"===e.key&&s()};return document.addEventListener("mousedown",e),document.addEventListener("scroll",t,!0),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("scroll",t,!0),document.removeEventListener("keydown",a)}},[s]),(0,T.createPortal)((0,n.jsx)("div",{ref:o,className:v("fixed z-[9999] min-w-[180px] bg-[#1a1a1a] border border-white/10 rounded shadow-xl py-1 text-sm text-[#e8e9ed]","flex flex-col animate-in fade-in zoom-in-95 duration-100",l),style:{top:Math.min(a,window.innerHeight-300),left:Math.min(t,window.innerWidth-200)},onContextMenu:e=>e.preventDefault(),children:r}),document.body)},E=e=>{let{icon:t,label:a,shortcut:i,onClick:s,danger:r,disabled:l,className:o}=e;return(0,n.jsxs)("button",{onClick:e=>{e.stopPropagation(),l||s()},disabled:l,className:v("flex items-center gap-2 px-3 py-1.5 w-full text-left transition-colors","hover:bg-[#292929]",r?"text-red-400 hover:text-red-300":"text-gray-200",l&&"opacity-50 cursor-not-allowed hover:bg-transparent",o),children:[t&&(0,n.jsx)("span",{className:"w-4 h-4 flex items-center justify-center",children:t}),(0,n.jsx)("span",{className:"flex-1",children:a}),i&&(0,n.jsx)("span",{className:"text-xs text-gray-500 font-mono ml-2",children:i})]})},P=()=>(0,n.jsx)("div",{className:"h-px bg-white/10 my-1 mx-2"});var z=a(6709),D=a(1);class H{static async request(e,t){let a=e.startsWith("http")?e:"".concat("").concat(e);console.log("[APIClient] Requesting: ".concat((null==t?void 0:t.method)||"GET"," ").concat(a));try{let e=await fetch(a,{...t,credentials:"include"});if(console.log("[APIClient] Response status: ".concat(e.status," for ").concat(a)),!e.ok){let t="";try{t=await e.text(),console.error("[APIClient] Error response body:",t)}catch(e){console.error("[APIClient] Could not read error body")}if(401===e.status)throw console.warn("[APIClient] Unauthorized - redirecting to login"),window.location.href="/api/auth/login",Error("Unauthorized - redirecting to login");throw Error("API Error ".concat(e.status,": ").concat(e.statusText).concat(t?" - ".concat(t):""))}let n=await e.json();return console.log("[APIClient] Success response for ".concat(a,":"),n),n}catch(e){throw console.error("[APIClient] Request failed for ".concat(a,":"),e),e}}static async getProfile(){return this.request("/api/profile")}static async getManifestVersion(){return this.request("/api/manifest/version")}static async getDefinitions(e){return this.request("/api/manifest/definitions/".concat(e))}static async getMetadata(){return this.request("/api/metadata")}static async updateMetadata(e,t,a){return this.request("/api/metadata",{method:"POST",body:JSON.stringify({itemId:e,type:t,value:a}),headers:{"Content-Type":"application/json"}})}static async transferItem(e,t,a,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this.request("/api/actions/transfer",{method:"POST",body:JSON.stringify({itemReferenceHash:e,stackSize:i,transferToVault:n,itemId:t,characterId:a,membershipType:3}),headers:{"Content-Type":"application/json"}})}}class A{static async moveItem(e){let{itemInstanceId:t,itemHash:a,sourceId:n,targetId:i}=e;if(n!==i){if(this.inProgress.has(t))throw Error("Transfer already in progress for this item");this.inProgress.add(t);try{console.log("[TransferService] Moving ".concat(t," from ").concat(n," to ").concat(i)),"vault"===n?await H.transferItem(a,t,i,!1):"vault"===i?await H.transferItem(a,t,n,!0):(console.log("[TransferService] Multi-hop: ".concat(n," -> Vault -> ").concat(i)),await H.transferItem(a,t,n,!0),await H.transferItem(a,t,i,!1)),console.log("[TransferService] Transfer complete: ".concat(t))}finally{this.inProgress.delete(t)}}}}function q(){let[e,t]=(0,i.useState)(null),[a,n]=(0,i.useState)(null),[s,r]=(0,i.useState)(!0),[l,o]=(0,i.useState)(null),c=(0,i.useCallback)(async()=>{r(!0),o(null);try{console.log("[useProfile] Starting profile fetch...");let[e,a]=await Promise.all([H.getProfile().catch(e=>{throw console.error("[useProfile] Profile fetch failed:",e),e}),H.getMetadata().catch(e=>{throw console.error("[useProfile] Metadata fetch failed:",e),e})]);console.log("[useProfile] Profile fetched successfully:",e),console.log("[useProfile] Metadata fetched successfully:",a),t(e),n(a)}catch(t){console.error("[useProfile] Error in refresh:",t);let e=t instanceof Error?t.message:"Unknown profile error";o(Error("Failed to load profile: ".concat(e)))}finally{r(!1)}},[]),d=(0,i.useMemo)(()=>{var t,n,i,s,r,l,o,c,d;if(!e||!a)return null;let x=e.characters.data||{},u=[];if(null===(n=e.profileInventory)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.items){let t=e.profileInventory.data.items.map(e=>({...e,isEquipped:!1,owner:"vault"}));u.push(...t)}Object.entries((null===(i=e.characterInventories)||void 0===i?void 0:i.data)||{}).forEach(e=>{let[t,a]=e,n=a.items.map(e=>({...e,isEquipped:!1,owner:t}));u.push(...n)}),Object.entries((null===(s=e.characterEquipment)||void 0===s?void 0:s.data)||{}).forEach(e=>{let[t,a]=e,n=a.items.map(e=>({...e,isEquipped:!0,owner:t}));u.push(...n)});let f=(null===(l=e.itemComponents)||void 0===l?void 0:null===(r=l.instances)||void 0===r?void 0:r.data)||{},h=(null===(d=e.profileProgression)||void 0===d?void 0:null===(c=d.data)||void 0===c?void 0:null===(o=c.seasonalArtifact)||void 0===o?void 0:o.powerBonus)||0;return{characters:x,items:u.map(e=>{var t,n;let i=e.itemInstanceId?f[e.itemInstanceId]:void 0,s=e.itemInstanceId,r=s?null===(t=a.tags)||void 0===t?void 0:t[s]:void 0,l=s?null===(n=a.notes)||void 0===n?void 0:n[s]:void 0;return{...e,instanceData:{...i,isEquipped:e.isEquipped},owner:e.owner,userTag:r||null,userNote:l||null}}),currencies:[],artifactPower:h}},[e,a]),x=(0,i.useCallback)(async(e,t,a)=>{n(n=>{if(!n)return null;let i={...n},s="tag"===t?{...n.tags}:{...n.notes};return a?s[e]=a:delete s[e],"tag"===t?i.tags=s:i.notes=s,i});try{await H.updateMetadata(e,t,a)}catch(e){console.error("Failed to sync metadata:",e),c()}},[c]),u=(0,i.useCallback)(async(e,a,n,i)=>{t(t=>{var a,n;if(!t)return null;let i=JSON.parse(JSON.stringify(t));if(null===(n=i.profileInventory)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.items){let t=i.profileInventory.data.items.findIndex(t=>t.itemInstanceId===e);if(t>-1){let[e]=i.profileInventory.data.items.splice(t,1)}}return t});try{let t=null==d?void 0:d.items.find(t=>t.itemInstanceId===e);if(!t)return;let s=t.owner;await A.moveItem({itemInstanceId:e,itemHash:a,sourceId:s,targetId:i?"vault":n}),c()}catch(e){console.error("Failed to move item:",e)}},[d,c]);return(0,i.useEffect)(()=>{c()},[c]),{profile:d,loading:s,error:l,refresh:c,updateItemMetadata:x,moveItem:u}}A.inProgress=new Set;let L=e=>{var t,a;let{x:i,y:s,onClose:r,item:l,definition:o}=e,{updateItemMetadata:c,moveItem:f,profile:h}=q();if(!l)return null;let m=(1&l.state)!=0,p=l.userTag,v=e=>{c(l.itemInstanceId,"tag",e),r()},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(l.itemInstanceId,l.itemHash,e,t),r()},b=Object.values((null==h?void 0:null===(t=h.characters)||void 0===t?void 0:t.data)||{});return(0,n.jsxs)(S,{x:i,y:s,onClose:r,children:[(0,n.jsx)("div",{className:"px-3 py-1.5 text-xs font-bold text-[#f5dc56] border-b border-white/10 mb-1 opacity-80 uppercase tracking-wider",children:(null==o?void 0:null===(a=o.displayProperties)||void 0===a?void 0:a.name)||"Unknown Item"}),(0,n.jsx)(E,{icon:(0,n.jsx)(x.A,{size:14,className:"favorite"===p?"fill-[#f5dc56] text-[#f5dc56]":""}),label:"Favorite",onClick:()=>v("favorite")}),(0,n.jsx)(E,{icon:(0,n.jsx)(u.A,{size:14,className:"junk"===p?"text-red-500":""}),label:"Junk",onClick:()=>v("junk")}),(0,n.jsx)(E,{icon:(0,n.jsx)(z.A,{size:14,className:"archive"===p?"text-blue-400":""}),label:"Archive",onClick:()=>v("archive")}),p&&(0,n.jsx)(E,{label:"Clear Tag",onClick:()=>v(null),className:"text-gray-500"}),(0,n.jsx)(P,{}),(0,n.jsx)(E,{icon:m?(0,n.jsx)(D.A,{size:14}):(0,n.jsx)(d.A,{size:14}),label:m?"Unlock":"Lock",onClick:()=>console.log("TODO: Implement Lock API")}),(0,n.jsx)(P,{}),(0,n.jsx)("div",{className:"px-3 py-1 text-[10px] text-gray-500 uppercase tracking-widest font-bold",children:"Transfer To"}),(0,n.jsx)(E,{icon:(0,n.jsx)(z.A,{size:14}),label:"Vault",onClick:()=>g("vault",!0),disabled:"vault"===l.owner}),b.map(e=>(0,n.jsx)(E,{icon:(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-cover",style:{backgroundImage:"url(https://www.bungie.net".concat(e.emblemPath,")")}}),label:["Titan","Hunter","Warlock"][e.classType],onClick:()=>g(e.characterId),disabled:l.owner===e.characterId},e.characterId))]})};var O=a(7792);let W="manifest_version",_="def:";class R{static async initialize(){try{let e=await (0,O.Jt)(W),t=await H.getManifestVersion(),a="".concat(t.version,"_").concat("v2");if(e!==a){for(let t of(console.log("Manifest update detected: ".concat(e," -> ").concat(a,". Clearing cache...")),await (0,O.HP)()))"string"==typeof t&&t.startsWith(_)&&(await (0,O.yH)(t),console.log("[ManifestManager] Cleared cached table: ".concat(t)));await (0,O.hZ)(W,a),console.log("[ManifestManager] Cache cleared. New version: ".concat(a))}}catch(e){console.error("Failed to initialize manifest manager:",e)}}static async loadTable(e){let t="".concat(_).concat(e),a=await (0,O.Jt)(t);if(a)console.log("[ManifestManager] Loaded ".concat(e," from Cache."));else{console.log("[ManifestManager] Downloading manifest table: ".concat(e,"..."));let n=performance.now();try{a=await H.getDefinitions(e);let i=JSON.stringify(a).length;console.log("[ManifestManager] Downloaded ".concat(e," in ").concat((performance.now()-n).toFixed(0),"ms. Size: ").concat((i/1024/1024).toFixed(2)," MB")),await (0,O.hZ)(t,a),console.log("[ManifestManager] Saved ".concat(e," to IndexedDB."))}catch(t){throw console.error("[ManifestManager] FAILED to download/save ".concat(e,":"),t),t}}return a}static async getDefinitions(e,t){console.log("[ManifestManager] Looking up ".concat(t.length," hashes from ").concat(e,"..."));let a=await this.loadTable(e),n={},i=Object.keys(a);if(console.log("[ManifestManager] Table has ".concat(i.length," entries. Sample keys:"),i.slice(0,3)),i.length>0){var s,r,l;let e=a[i[0]];console.log("[ManifestManager] Sample definition structure:",{hash:null==e?void 0:e.hash,name:null==e?void 0:null===(s=e.displayProperties)||void 0===s?void 0:s.name,icon:null==e?void 0:null===(l=e.displayProperties)||void 0===l?void 0:null===(r=l.icon)||void 0===r?void 0:r.substring(0,50)})}let o=0;for(let e of t){let t=e.toString();a[t]&&(n[t]=a[t],o++)}return console.log("[ManifestManager] Found ".concat(o," / ").concat(t.length," definitions.")),n}}function B(){let[e,t]=(0,i.useState)(""),[a,l]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),d=(0,r.FR)((0,r.MS)(r.AN,{activationConstraint:{distance:8}})),{profile:x,loading:u,error:f,moveItem:h}=q(),m=(null==x?void 0:x.items.map(e=>e.itemHash))||[],{definitions:p,loading:v}=function(e,t){let[a,n]=(0,i.useState)({}),[s,r]=(0,i.useState)(!0),[l,o]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(0===t.length){r(!1);return}let a=!0;return async function(){try{let i=await R.getDefinitions(e,t);a&&(n(i),r(!1))}catch(e){a&&(o(e instanceof Error?e:Error(String(e))),r(!1))}}(),()=>{a=!1}},[e,JSON.stringify(t)]),{definitions:a,loading:s,error:l}}("DestinyInventoryItemDefinition",m),g=u||m.length>0&&v,b=(e,t,a)=>{e.preventDefault(),c({x:e.clientX,y:e.clientY,item:t,definition:a})};if(g)return(0,n.jsxs)("div",{className:"h-screen bg-[#050505] text-white flex flex-col items-center justify-center font-mono space-y-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-t-transparent border-[#f5dc56] rounded-full animate-spin"}),(0,n.jsx)("div",{className:"animate-pulse text-[#f5dc56]",children:"INITIALIZING GUARDIAN NEXUS..."}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Connecting to Neural Net (Cloudflare Worker)"})]});if(f)return(0,n.jsxs)("div",{className:"h-screen bg-[#050505] text-red-500 flex flex-col items-center justify-center font-mono p-4",children:[(0,n.jsx)("div",{className:"text-xl mb-4",children:"CRITICAL SYSTEM FAILURE"}),(0,n.jsx)("div",{className:"bg-red-900/20 border border-red-500/50 p-4 rounded max-w-md break-words",children:f.message}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-8 px-6 py-2 bg-red-600 hover:bg-red-500 text-white rounded font-bold transition-colors",children:"REBOOT SYSTEM"})]});let y=function(e,t,a){if(!t||!t.trim())return e;let n=t.toLowerCase().trim().split(" ").filter(e=>e.length>0);return e.filter(e=>{let t=a[e.itemHash];if(!t)return!1;let i=t.displayProperties.name.toLowerCase(),s=t.itemTypeDisplayName.toLowerCase();return n.every(a=>{if(a.startsWith("is:")){var n,r,l,o,c,d;let i=a.replace("is:","");return"exotic"===i?6===t.inventory.tierType:"legendary"===i?5===t.inventory.tierType:"rare"===i?4===t.inventory.tierType:"common"===i?2===t.inventory.tierType:"weapon"===i?3===t.itemType:"armor"===i?2===t.itemType:"kinetic"===i?(null===(n=e.instanceData)||void 0===n?void 0:n.damageType)===1||1===t.defaultDamageType:"arc"===i?(null===(r=e.instanceData)||void 0===r?void 0:r.damageType)===2||2===t.defaultDamageType:"solar"===i?(null===(l=e.instanceData)||void 0===l?void 0:l.damageType)===3||3===t.defaultDamageType:"void"===i?(null===(o=e.instanceData)||void 0===o?void 0:o.damageType)===4||4===t.defaultDamageType:"stasis"===i?(null===(c=e.instanceData)||void 0===c?void 0:c.damageType)===6||6===t.defaultDamageType:"strand"!==i||(null===(d=e.instanceData)||void 0===d?void 0:d.damageType)===7||7===t.defaultDamageType}return i.includes(a)||s.includes(a)})})}((null==x?void 0:x.items)||[],e,p),j=y.filter(e=>"vault"===e.owner),N=(null==x?void 0:x.characters)?Object.values(x.characters):[],M=e=>{let t=y.filter(t=>t.owner===e);return{equipment:t.filter(e=>{var t;return null===(t=e.instanceData)||void 0===t?void 0:t.isEquipped}),inventory:t.filter(e=>{var t;return!(null===(t=e.instanceData)||void 0===t?void 0:t.isEquipped)})}};return(0,n.jsx)(r.Mp,{sensors:d,onDragStart:e=>{e.active.data.current&&l(e.active.data.current)},onDragEnd:e=>{var t;let{active:a,over:n}=e;if(l(null),!n)return;let i=null===(t=a.data.current)||void 0===t?void 0:t.item,s=n.id;if(!i||i.owner===s)return;let r="vault"===s;console.log("Moving item ".concat(i.itemInstanceId," from ").concat(i.owner," to ").concat(s)),h(i.itemInstanceId,i.itemHash,s,r)},children:(0,n.jsxs)("div",{className:"h-screen bg-[#11111b] text-[#e8e9ed] font-sans flex flex-col overflow-hidden selection:bg-[#f5dc56] selection:text-black",children:[(0,n.jsxs)("div",{className:"h-12 bg-[#0d0d15] border-b border-white/5 flex items-center px-4 justify-between flex-shrink-0 z-50 shadow-md",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)("span",{className:"font-bold text-xl tracking-tight text-white",children:["Guardian",(0,n.jsx)("span",{className:"text-[#f5dc56]",children:"Nexus"})]}),(0,n.jsxs)("nav",{className:"flex gap-4 text-sm font-medium text-gray-400",children:[(0,n.jsx)("button",{className:"text-white hover:text-white transition-colors bg-[#292929] px-3 py-1 rounded",children:"Inventory"}),(0,n.jsx)("button",{className:"hover:text-white transition-colors",children:"Progress"}),(0,n.jsx)("button",{className:"hover:text-white transition-colors",children:"Vendors"})]})]}),(0,n.jsx)("div",{className:"flex-1 max-w-xl px-8",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(s.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-gray-500"}),(0,n.jsx)("input",{id:"search-items",name:"search",type:"text",placeholder:"Search item, perk, is:dupe...",className:"w-full bg-[#000]/30 border border-white/10 rounded-sm py-1.5 pl-9 pr-4 text-sm text-white placeholder:text-gray-600 focus:outline-none focus:border-[#f5dc56]/50 transition-colors font-mono",value:e,onChange:e=>t(e.target.value)})]})}),(0,n.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[(0,n.jsx)("button",{className:"hover:text-white",children:"Settings"}),(0,n.jsx)("div",{className:"size-6 bg-gradient-to-tr from-[#f5dc56] to-[#f5dc56]/50 rounded-full border border-white/10"})]})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-x-auto flex divide-x divide-[#333]",children:[N.map(e=>{let{equipment:t,inventory:a}=M(e.characterId);return(0,n.jsx)(I,{id:e.characterId,className:"flex-shrink-0 h-full relative",children:(0,n.jsx)(k,{character:e,equipment:t,inventory:a,definitions:p,artifactPower:(null==x?void 0:x.artifactPower)||0,onItemContextMenu:b})},e.characterId)}),(0,n.jsxs)(I,{id:"vault",className:"flex-shrink-0 w-[400px] bg-[#11111b] flex flex-col h-full relative",children:[(0,n.jsxs)("div",{className:"h-[48px] flex items-center px-4 bg-[#0d0d15] border-b border-white/5 justify-between flex-shrink-0 shadow-md",children:[(0,n.jsx)("span",{className:"font-bold text-lg text-[#ccc]",children:"Vault"}),(0,n.jsxs)("span",{className:"text-sm font-mono text-[#666]",children:[j.length," / 600"]})]}),(0,n.jsx)("div",{className:"h-[25px] bg-[#0a0a10] border-b border-white/5"}),(0,n.jsx)("div",{className:"flex-1 overflow-hidden relative p-1",children:(0,n.jsx)(C,{items:j,definitions:p,onItemContextMenu:b})})]})]}),(0,n.jsx)(r.Hd,{children:a?(0,n.jsx)("div",{className:"w-[48px] h-[48px] shadow-2xl scale-110 pointer-events-none cursor-grabbing",children:(0,n.jsx)(w,{item:a.item,definition:a.definition,className:"border-[#f5dc56] shadow-[0_0_15px_rgba(245,220,86,0.5)]"})}):null}),o&&(0,n.jsx)(L,{x:o.x,y:o.y,item:o.item,definition:o.definition,onClose:()=>c(null)})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[534,441,517,358],()=>t(1847)),_N_E=e.O()}]);